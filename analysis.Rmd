---
title: "analysis mouse assymetry"
output: github_document
author: "Joanes Grandjean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load libraries}
#tidy stuff
library(tidyverse)
library(glue)

#linear mixed model
library(lme4)

#easystat
library(effectsize)
library(parameters)
library(performance)
library(modelbased)
library(report)
```



# asset preparation and validation. 
the exisiting DSURQE label info is not very clear. Here I reshape it for better visualization.

```{r reshape the DSURQE label index}
roi_raw <- read_csv('asset/DSURQE_40micron_R_mapping.csv')


roi_merge <- tibble(dsurqe_struct=c(glue('Right {roi_raw$Structure}'),glue('Left {roi_raw$Structure}')), 
                   abi_struct=c(glue('Right {roi_raw$ABI}'),glue('Left {roi_raw$ABI}')), 
                   tissue=c(roi_raw$`tissue type`, roi_raw$`tissue type`), 
                   label=c(roi_raw$`right label`, roi_raw$`left label`),
                   hemisphere=c(rep('right', dim(roi_raw)[1]), rep('left', dim(roi_raw)[1]))) %>% arrange(label)

duplicated_index <- duplicated(roi_merge$label)
duplicated_label <- roi_merge$label[duplicated_index]

roi_merge<-roi_merge[!duplicated_index,]

roi_merge$hemisphere[roi_merge$label %in% duplicated_label] <- 'inter'


write_csv(roi_merge, 'asset/roi_label_clean.csv')


report(roi_merge)
```


```{r load global variables}

study <- read_csv('asset/study_stable.csv')
roi_merge <- read_csv('asset/roi_label_clean.csv')

data_path <- 'sample_test/'

```

```{r list missing data}

vol_AI_list <- file.path(data_path,'vol_AI') %>% dir  %>% gsub("_01_SE01_MR.nii.gz","",.)
study$POND_Mouse_ID[which(!study$POND_Mouse_ID %in% vol_AI_list)]

```




```{r}
label_extract <- read_table('asset/label_extract',col_names = FALSE) %>%  pivot_longer(everything()) %>%  select(value) %>% .$value
roi_extra_orig <- read_table('sample_test/roi_orig/PND12_HSC_0001_01_SE01_MR.txt',col_names = FALSE) %>%  pivot_longer(everything()) %>%  select(value) %>% .$value
roi_extra_flip <- read_table('sample_test/roi_flip/PND12_HSC_0001_01_SE01_MR.txt',col_names = FALSE) %>%  pivot_longer(everything()) %>%  select(value) %>% .$value
```



```{r}

tmp<-read_csv('~/Desktop/sub-395549_bold_RAS_combined_cleaned_FC_matrix.csv') %>% .[-1]
dim(tmp)

library(RMINC)
roi_merge$nvox = c()

atlas <- mincGetVolume('asset/DSURQE_40micron_labels.mnc') %>% mincArray(dimIndex = 1)
for(i in 1:dim(roi_merge)[1]){
  roi_merge$nvox[i] <-  sum(atlas[,,]==roi_merge$label[i])
}

# print the number of voxels when the atlas is resampled to 0.3um from 0.04 isotropic. 
sort((roi_merge$nvox * 0.04^3)/(0.3^3))
```

